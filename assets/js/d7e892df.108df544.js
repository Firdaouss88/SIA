"use strict";(self.webpackChunksia_doc=self.webpackChunksia_doc||[]).push([[9205],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return m}});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},c=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),d=u(n),m=r,f=d["".concat(s,".").concat(m)]||d[m]||p[m]||o;return n?a.createElement(f,l(l({ref:t},c),{},{components:n})):a.createElement(f,l({ref:t},c))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,l=new Array(o);l[0]=d;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:r,l[1]=i;for(var u=2;u<o;u++)l[u]=n[u];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},58630:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return s},default:function(){return m},frontMatter:function(){return i},metadata:function(){return u},toc:function(){return p}});var a=n(87462),r=n(63366),o=(n(67294),n(3905)),l=["components"],i={},s=void 0,u={unversionedId:"Formation PBI/801300/Format_Dax_DA-Contextes-\xe9valuation-avanc\xe9s",id:"Formation PBI/801300/Format_Dax_DA-Contextes-\xe9valuation-avanc\xe9s",title:"Format_Dax_DA-Contextes-\xe9valuation-avanc\xe9s",description:"Introduction",source:"@site/docs\\80-Formation PBI\\801300\\801300_Format_Dax_DA-Contextes-\xe9valuation-avanc\xe9s.md",sourceDirName:"80-Formation PBI/801300",slug:"/Formation PBI/801300/Format_Dax_DA-Contextes-\xe9valuation-avanc\xe9s",permalink:"/docs/Formation PBI/801300/Format_Dax_DA-Contextes-\xe9valuation-avanc\xe9s",editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/80-Formation PBI/801300/801300_Format_Dax_DA-Contextes-\xe9valuation-avanc\xe9s.md",tags:[],version:"current",sidebarPosition:801300,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Format_Dax_Calcul-DAX",permalink:"/docs/Formation PBI/801300/Format_Dax_Calcul-DAX"},next:{title:"Format_Dax_DA-Evaluation-contextes",permalink:"/docs/Formation PBI/801300/Format_Dax_DA-Evaluation-contextes"}},c={},p=[{value:"Introduction",id:"introduction",level:2},{value:"Modificateurs de la fonction CALCULATE",id:"modificateurs-de-la-fonction-calculate",level:2},{value:"USERELATIONSHIP",id:"userelationship",level:2},{value:"CROSSFILTER",id:"crossfilter",level:2},{value:"Transition de contexte",id:"transition-de-contexte",level:2},{value:"D\xe9pendance circulaire",id:"d\xe9pendance-circulaire",level:2},{value:"L&#39;ordre d&#39;ex\xe9cution dans CALCULATE",id:"lordre-dex\xe9cution-dans-calculate",level:2}],d={toc:p};function m(e){var t=e.components,i=(0,r.Z)(e,l);return(0,o.kt)("wrapper",(0,a.Z)({},d,i,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"contextes-d\xe9valuation-avanc\xe9s"},"Contextes d'\xe9valuation avanc\xe9s"),(0,o.kt)("h2",{id:"introduction"},"Introduction"),(0,o.kt)("p",null,"Dans ce document, on va expliquer la diff\xe9rence entre les filtres et les modificateurs de la fonction CALCULATE ainsi la transaction de contexte qui se produit lorsque la fonction CALCULATE est ex\xe9cut\xe9e dans un contexte de ligne."),(0,o.kt)("h2",{id:"modificateurs-de-la-fonction-calculate"},"Modificateurs de la fonction CALCULATE"),(0,o.kt)("p",null,"La fonction CALCULATE accepte deux types d'arguments : Filtres et Modificateurs.\nCes derniers se comportent de diff\xe9rentes mani\xe8res et ils affectent le contexte d'\xe9valuation final g\xe9n\xe9r\xe9 par CALCULATE."),(0,o.kt)("p",null,"Un modificateur change le comportement de CALCULATE , par exemple la fonction ALL, ALLSELECTED, ALLNOBLANKROW , en fait toute fonction commence par ALL est utilis\xe9 dans CALCULATE comme un modificateur, et il existe aussi les modificateurs CROSSFILTER et USERLATIONSHIP et qui ne sont pas des filtres."),(0,o.kt)("h2",{id:"userelationship"},"USERELATIONSHIP"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"USERELATIONSHIP")," est un modificateur ",(0,o.kt)("strong",{parentName:"p"},"CALCULATE")," qui demande \xe0 la fonction CALCULATE d'activer temporairement la relation. Lorsque ",(0,o.kt)("strong",{parentName:"p"},"CALCULATE")," a calcul\xe9 son r\xe9sultat, la relation par d\xe9faut redevient active.\nSi deux tables sont li\xe9es par plusieurs relations, vous pouvez d\xe9cider quelle relation activ\xe9e \xe0 l'aide de la fonction ",(0,o.kt)("strong",{parentName:"p"},"USERELATIONSHIP")," .\nEn effet, vous ne pouvez avoir qu'une seule relation active entre deux tables. Par exemple, vous commencez avec un mod\xe8le o\xf9 les ",(0,o.kt)("em",{parentName:"p"},"ventes")," sont li\xe9es \xe0 la ",(0,o.kt)("em",{parentName:"p"},"date")," via la colonne ",(0,o.kt)("em",{parentName:"p"},"Date")," , comme dans l'image suivante."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"DA-Contextes-\xe9valuation-avanc\xe9s-1",src:n(45297).Z,width:"1359",height:"563"})),(0,o.kt)("p",null,"Si vous cr\xe9ez une deuxi\xe8me relation, bas\xe9e sur les colonnes ",(0,o.kt)("em",{parentName:"p"},"Date de livraison")," , la deuxi\xe8me relation est une relation inactive."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"DA-Contextes-\xe9valuation-avanc\xe9s-2",src:n(58270).Z,width:"1359",height:"564"})),(0,o.kt)("p",null,"Les relations inactives sont de nature non-actives. Par cons\xe9quent, si vous filtrez par ",(0,o.kt)("em",{parentName:"p"},"ann\xe9e,")," le rapport affiche les ventes dont la ",(0,o.kt)("em",{parentName:"p"},"date de commande")," appartient \xe0 l'ann\xe9e filtr\xe9e. ",(0,o.kt)("em",{parentName:"p"},"La date de livraison")," n'est pas utilis\xe9e dans le cadre du filtrage par d\xe9faut. Afin de filtrer les ",(0,o.kt)("em",{parentName:"p"},"ventes en")," fonction de la ",(0,o.kt)("em",{parentName:"p"},"date de livraison")," , vous pouvez activer temporairement une relation en utilisant la fonction ",(0,o.kt)("strong",{parentName:"p"},"USERELATIONSHIP")," ."),(0,o.kt)("p",null,"La mesure ",(0,o.kt)("em",{parentName:"p"},"Montant de la livraison")," ci-dessous calcule le montant livr\xe9 dans un certain d\xe9lai, contrairement au montant command\xe9 retourn\xe9 par la mesure ",(0,o.kt)("em",{parentName:"p"},"Montant des ventes")," :"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"Delivery Amount =\n            CALCULATE (\n                        [Sales Amount] ,\n                        USERELATIONSHIP ( Sales [ Delivery Date] , Date [ Date])\n    )\n")),(0,o.kt)("p",null,"Vous pouvez comparer le ",(0,o.kt)("em",{parentName:"p"},"montant de la livraison")," avec le ",(0,o.kt)("em",{parentName:"p"},"montant")," des ",(0,o.kt)("em",{parentName:"p"},"ventes")," dans la figure suivante :"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"DA-Contextes-\xe9valuation-avanc\xe9s-3",src:n(66137).Z,width:"765",height:"702"})),(0,o.kt)("p",null,"Les arguments de ",(0,o.kt)("strong",{parentName:"p"},"USERELATIONSHIP")," sont les deux colonnes qui forment la relation. L'ordre des colonnes n'est pas pertinent, m\xeame s'il est courant d'utiliser la colonne du c\xf4t\xe9 multiple de la relation ( ",(0,o.kt)("em",{parentName:"p"},"Sales")," dans notre exemple) en premier, et le c\xf4t\xe9 un ( ",(0,o.kt)("em",{parentName:"p"},"Date")," dans l'exemple) en second. Cela dit, c'est juste une convention standard; l'ordre inverse ne modifie pas le r\xe9sultat."),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"La relation doit d\xe9j\xe0 \xeatre dans le mod\xe8le. Vous ne pouvez pas utiliser ",(0,o.kt)("strong",{parentName:"p"},"USERELATIONSHIP")," pour cr\xe9er une relation al\xe9atoire. ",(0,o.kt)("strong",{parentName:"p"},"USERELATIONSHIP")," ne peut activer qu'une relation existante.")),(0,o.kt)("h2",{id:"crossfilter"},"CROSSFILTER"),(0,o.kt)("p",null,"La fonction ",(0,o.kt)("strong",{parentName:"p"},"CROSSFILTER")," est un modificateur CALCULATE, elle vous permet de changer la propagation du filtre crois\xe9 d'une relation .\nElle comporte trois arguments, la colonne de gauche d'une relation, la colonne droite d'une relation et le type de filtre crois\xe9, ce dernier contient diff\xe9rents types soit on l'\xe9crit en chiffre soit la description du chiffre :"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"0 pour ",(0,o.kt)("strong",{parentName:"p"},"None"),",  1 pour ",(0,o.kt)("strong",{parentName:"p"},"OneWay"),",  2 pour ",(0,o.kt)("strong",{parentName:"p"},"Both"),", 3 pour ",(0,o.kt)("strong",{parentName:"p"},"OneWay_RightFiltersLeft"),", 4 pour ",(0,o.kt)("strong",{parentName:"p"},"OneWay_LeftFiltersRight"),". ")),(0,o.kt)("p",null,"Les arguments ",(0,o.kt)("strong",{parentName:"p"},"OneWay_RightFiltersLeft")," et ",(0,o.kt)("strong",{parentName:"p"},"OneWay_LeftFiltersRight")," peuvent \xeatre utilis\xe9s dans les types de relation plusieurs-\xe0-plusieurs et un-\xe0-plusieurs, mais pas dans le type de relation un-\xe0-un.\nLorsque le type de filtre crois\xe9 ",(0,o.kt)("strong",{parentName:"p"},"OneWay_RightFiltersLeft")," ou ",(0,o.kt)("strong",{parentName:"p"},"OneWay_LeftFiltersRight")," est utilis\xe9 dans un type de relation un-\xe0-plusieurs, il doit \xeatre coh\xe9rent avec la seule propagation de filtre autoris\xe9e, qui est un-\xe0-plusieurs. Si le sens demand\xe9 est l'inverse, ",(0,o.kt)("strong",{parentName:"p"},"CROSSFILTER")," renvoie une erreur."),(0,o.kt)("p",null,"Voyons \xe7a dans le code suivant :"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"Num Of Customers = \n                CALCULATE(\n                            DISTINCTCOUNT ( Customers [ Customer Name]),\n                            CROSSFILTER (\n                                        SAles [ CustomerKey],\n                                        Customer [ CustomerKey],\n                                        BOTH\n                            )\n)\n")),(0,o.kt)("p",null,"La mesure nombre de clients va calculer le nombre distinct des noms des clients, en utilisant le filtre crois\xe9 bidirectionnel entre la cl\xe9 de client qui se trouve dans la table des ventes et celle qui se trouve dans la table des clients ."),(0,o.kt)("h2",{id:"transition-de-contexte"},"Transition de contexte"),(0,o.kt)("p",null,"La transition du contexte est le seul point o\xf9 le contexte de ligne et le contexte de filtre se croise ou se rencontre.\nLa formule suivante effectue une it\xe9ration sur la table des ventes et calcule la somme de la quantit\xe9. "),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"DA-Contextes-\xe9valuation-avanc\xe9s-4",src:n(874).Z,width:"968",height:"460"})),(0,o.kt)("p",null,"Dans l'image au-dessus, on rassemble le contexte de ligne qui est l'it\xe9ration de SUMX sur la table des ventes donc ligne par ligne et le filtre qui va se faire \xe0 l'ai de du CALCULATE pour calculer la somme de la quantit\xe9."),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Il faut \xe9viter la transition de contexte lors d'une it\xe9ration sur une table qui contient des doublons car le r\xe9sultat sera erron\xe9.")),(0,o.kt)("h2",{id:"d\xe9pendance-circulaire"},"D\xe9pendance circulaire"),(0,o.kt)("p",null,"La transition de contexte est une d\xe9pendance circulaire.\nLes objets calcul\xe9s se r\xe9f\xe8rent souvent les uns aux autres. Par exemple, vous cr\xe9ez trois colonnes calcul\xe9es dans ",(0,o.kt)("em",{parentName:"p"},"Sales")," pour calculer ",(0,o.kt)("em",{parentName:"p"},"Line Amount")," , ",(0,o.kt)("em",{parentName:"p"},"Line Cost")," et ",(0,o.kt)("em",{parentName:"p"},"Line Margin")," :"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"Line Amount = Sales[Quantity] * Sales[Net Price]\nLine Cost = Sales[Quantity] * Sales[Unit Cost]\nLine Margin = Sales[Line Amount] - Sales[Line Cost]\n")),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"Le montant de la ligne")," et le ",(0,o.kt)("em",{parentName:"p"},"co\xfbt de la ligne")," sont calcul\xe9s en fonction des colonnes d\xe9j\xe0 pr\xe9sentes dans le tableau.\n",(0,o.kt)("em",{parentName:"p"},"La marge de ligne")," n\xe9cessite les valeurs de ",(0,o.kt)("em",{parentName:"p"},"Montant de")," ",(0,o.kt)("em",{parentName:"p"},"ligne")," et de ",(0,o.kt)("em",{parentName:"p"},"Co\xfbt de ligne")," afin de produire un r\xe9sultat.\nPar cons\xe9quent, DAX sait qu'il doit calculer le ",(0,o.kt)("em",{parentName:"p"},"montant de la")," ",(0,o.kt)("em",{parentName:"p"},"ligne")," et le ",(0,o.kt)("em",{parentName:"p"},"co\xfbt de la ligne")," avant de calculer la ",(0,o.kt)("em",{parentName:"p"},"marge de la ligne"),".\nAvec trois colonnes, il est assez facile de suivre les d\xe9pendances mais dans un mod\xe8le r\xe9el avec de nombreuses colonnes, les d\xe9pendances sont beaucoup plus complexes \xe0 suivre. Cela dit, le moteur DAX garde une trace de quelle entit\xe9 d\xe9pend de laquelle. Il utilise un diagramme de d\xe9pendances pour construire un plan d'ex\xe9cution o\xf9 chaque entit\xe9 est calcul\xe9e apr\xe8s tous les objets dont d\xe9pend l'entit\xe9 d'origine. "),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Vous pouvez obtenir une d\xe9pendance circulaire dans deux sc\xe9narios principaux :"),(0,o.kt)("ul",{parentName:"blockquote"},(0,o.kt)("li",{parentName:"ul"},"Lors de la cr\xe9ation d'une colonne calcul\xe9e qui semble parfaitement l\xe9gitime et qui utilise ",(0,o.kt)("strong",{parentName:"li"},"CALCULATE")," ;"),(0,o.kt)("li",{parentName:"ul"},"Lorsque vous essayez de cr\xe9er une relation entre deux tables, dont l'une est une table calcul\xe9e, ou lorsque la relation est bas\xe9e sur une colonne calcul\xe9e."))),(0,o.kt)("h2",{id:"lordre-dex\xe9cution-dans-calculate"},"L'ordre d'ex\xe9cution dans CALCULATE"),(0,o.kt)("p",null,"Pour bien comprendre l'ordre, prenons le code suivant :"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"DA-Contextes-\xe9valuation-avanc\xe9s-5",src:n(65110).Z,width:"415",height:"223"})),(0,o.kt)("p",null,"Vous avez la fonction CALCULATE le montant des ventes avec le filtre qui d\xe9clare l'ann\xe9e civile livr\xe9 \xe9gale \xe0 2007 et un modificateur USERELATIONSHIP qui change la relation active.\nL'ordre de l'ex\xe9cution sera le suivant : Apr\xe8s le modificateur USERELATIONSHIP terminera son travail ,le filtre sera appliqu\xe9 sur le r\xe9sultat du modificateur et \xe0 la fin CALCULATE s'ex\xe9cutera."))}m.isMDXComponent=!0},45297:function(e,t,n){t.Z=n.p+"assets/images/DA-Contextes-evaluation-avances-1-2a6c12755601738bde486ba842cacca4.png"},58270:function(e,t,n){t.Z=n.p+"assets/images/DA-Contextes-evaluation-avances-2-dcca1734415a52b5f0b81784d4dfba2b.png"},66137:function(e,t,n){t.Z=n.p+"assets/images/DA-Contextes-evaluation-avances-3-3995fe469748825553e2c0d61d19eded.png"},874:function(e,t,n){t.Z=n.p+"assets/images/DA-Contextes-evaluation-avances-4-4b900f363519cf08a70fd99b572b9d10.png"},65110:function(e,t,n){t.Z=n.p+"assets/images/DA-Contextes-evaluation-avances-5-b16843bf75b345f634d4c242625f501e.png"}}]);